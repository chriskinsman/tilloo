language: node_js
node_js:
  - 4.2.2


build:
  ci:
    - npm install gulp -g
    - npm install
    - bower --allow-root install
    - gulp lint
    - pushd nodeimage
    - docker build -t tilloo/nodeimage -f nodeimage.docker .
    - popd
    - docker build -t tilloo/base:$BUILD_NUMBER -f tilloo-base.docker .
    - docker build -t tilloo/cli:$BUILD_NUMBER -f cli.docker .
    - docker build -t tilloo/scheduler:$BUILD_NUMBER -f scheduler.docker .
    - docker build -t tilloo/webserver:$BUILD_NUMBER -f webserver.docker .
    - docker build -t tilloo/worker:$BUILD_NUMBER -f worker.docker .

  post_ci:
    - docker push tilloo/base:$BUILD_NUMBER
    - docker push tilloo/scheduler:$BUILD_NUMBER
    - docker push tilloo/worker:$BUILD_NUMBER
    - docker push tilloo/webserver:$BUILD_NUMBER
    - docker push tilloo/cli:$BUILD_NUMBER

integrations:
  hub:
    - integrationName: DockerChrisKinsman
      type: docker

  cache: true

