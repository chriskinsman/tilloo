language: node_js
node_js:
  - 4.2.2


build:
  ci:
    - npm install gulp -g
    - npm install
    - bower --allow-root install
    - gulp lint
    - pushd nodeimage
    - docker build -t tilloo/nodeimage:$BUILD_NUMBER -t tilloo/nodeimage:latest -f nodeimage.docker .
    - popd
    - docker build -t tilloo/base:$BUILD_NUMBER -t tilloo/base:latest -f tilloo-base.docker .
    - docker build -t tilloo/cli:$BUILD_NUMBER -t tilloo/cli:latest -f cli.docker .
    - docker build -t tilloo/scheduler:$BUILD_NUMBER -t tilloo/scheduler:latest -f scheduler.docker .
    - docker build -t tilloo/webserver:$BUILD_NUMBER -t tilloo/webserver:latest -f webserver.docker .
    - docker build -t tilloo/worker:$BUILD_NUMBER -t tilloo/worker:latest -f worker.docker .

  post_ci:
    - docker push tilloo/nodeimage:$BUILD_NUMBER
    - docker push tilloo/base:$BUILD_NUMBER
    - docker push tilloo/scheduler:$BUILD_NUMBER
    - docker push tilloo/worker:$BUILD_NUMBER
    - docker push tilloo/webserver:$BUILD_NUMBER
    - docker push tilloo/cli:$BUILD_NUMBER
    - docker push tilloo/nodeimage:latest
    - docker push tilloo/base:latest
    - docker push tilloo/scheduler:latest
    - docker push tilloo/worker:latest
    - docker push tilloo/webserver:latest
    - docker push tilloo/cli:latest



integrations:
  hub:
    - integrationName: DockerChrisKinsman
      type: docker

  cache: true

